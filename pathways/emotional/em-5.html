<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0d0906">
  <title>InnerShadow ‚Äì Your Patterns and Where They Came From</title>
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="/css/main.css">
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    html, body {
      position: fixed;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    body {
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-dark);
    }

    .shell {
      width: 100%;
      max-width: 28rem;
      height: 100vh;
      height: -webkit-fill-available;
      background: var(--bg-card);
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
      border-left: 1px solid var(--border-subtle);
      border-right: 1px solid var(--border-subtle);
    }

    .module-header {
      padding: max(1rem, env(safe-area-inset-top)) 1.25rem 0.875rem;
      background: rgba(10,15,30,0.95);
      border-bottom: 1px solid var(--border-subtle);
      flex-shrink: 0;
      z-index: 10;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .module-header__row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .header-back {
      width: 2.25rem;
      height: 2.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-card-light);
      border: 1px solid var(--border-soft);
      border-radius: 0.625rem;
      color: var(--text-primary);
      font-size: 1rem;
      cursor: pointer;
      transition: var(--transition-fast);
      flex-shrink: 0;
    }

    .header-back:active { transform: scale(0.92); }

    .header-title {
      flex: 1;
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-primary);
      line-height: 1.3;
      text-align: center;
    }

    .header-count {
      font-size: 0.8125rem;
      color: var(--text-muted);
      font-weight: 500;
      min-width: 2.25rem;
      text-align: right;
    }

    .progress-dots {
      display: flex;
      gap: 0.3rem;
    }

    .progress-dot {
      flex: 1;
      height: 3px;
      background: rgba(148,163,184,0.15);
      border-radius: 999px;
      transition: background 0.4s ease;
    }

    .progress-dot--active {
      background: var(--gradient-main);
    }

    .module-scroll {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }

    .module-scroll::-webkit-scrollbar { display: none; }

    .step-wrap {
      padding: 1.375rem 1.25rem 2rem;
    }

    .cta-area {
      padding: 1rem 1.25rem max(1rem, env(safe-area-inset-bottom));
      background: rgba(10,15,30,0.95);
      border-top: 1px solid var(--border-subtle);
      display: flex;
      gap: 0.75rem;
      align-items: center;
      flex-shrink: 0;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .back-btn-sm {
      width: 3rem;
      height: 3rem;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-card-light);
      border: 1px solid var(--border-soft);
      border-radius: 0.875rem;
      color: var(--text-secondary);
      font-size: 1.125rem;
      cursor: pointer;
      transition: var(--transition-fast);
      flex-shrink: 0;
    }

    .back-btn-sm:active { transform: scale(0.92); }
    .back-btn-sm:disabled { opacity: 0.3; cursor: default; }

    /* Pattern cards ‚Äî selectable */
    .pattern-option {
      display: flex;
      align-items: flex-start;
      gap: 0.875rem;
      padding: 1rem 1.125rem;
      background: var(--bg-card-light);
      border: 2px solid var(--border-soft);
      border-radius: 1rem;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-bottom: 0.625rem;
      text-align: left;
      width: 100%;
      font-family: var(--font-body);
    }

    .pattern-option:active { transform: scale(0.98); }

    .pattern-option--selected {
      border-color: var(--ember-border-strong);
      background: var(--ember-bg);
    }

    .pattern-option__emoji {
      font-size: 1.5rem;
      line-height: 1;
      flex-shrink: 0;
      margin-top: 0.125rem;
    }

    .pattern-option__body { flex: 1; }

    .pattern-option__name {
      font-size: 0.9375rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.25rem;
    }

    .pattern-option--selected .pattern-option__name {
      color: var(--text-ember);
    }

    .pattern-option__desc {
      font-size: 0.8125rem;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    .pattern-option__check {
      width: 1.375rem;
      height: 1.375rem;
      border-radius: 50%;
      border: 2px solid var(--border-softer);
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      transition: all 0.2s ease;
      margin-top: 0.125rem;
    }

    .pattern-option--selected .pattern-option__check {
      background: var(--ember);
      border-color: var(--ember);
      color: white;
    }

    /* Pattern anatomy */
    .anatomy-row {
      display: flex;
      align-items: center;
      gap: 0.625rem;
      margin-bottom: 0.5rem;
    }

    .anatomy-label {
      font-size: 0.75rem;
      font-weight: 700;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      width: 5rem;
      flex-shrink: 0;
      color: var(--text-muted);
    }

    .anatomy-value {
      flex: 1;
      font-size: 0.875rem;
      color: var(--text-secondary);
      line-height: 1.5;
      padding: 0.5rem 0.75rem;
      background: var(--bg-card-light);
      border-radius: 0.625rem;
      border: 1px solid var(--border-subtle);
    }

    /* Timeline */
    .timeline-item {
      display: flex;
      gap: 0.875rem;
      align-items: flex-start;
      margin-bottom: 1rem;
      position: relative;
    }

    .timeline-dot {
      width: 0.75rem;
      height: 0.75rem;
      border-radius: 50%;
      background: var(--ember);
      flex-shrink: 0;
      margin-top: 0.3rem;
      position: relative;
      z-index: 1;
    }

    .timeline-line {
      position: absolute;
      left: 0.3125rem;
      top: 1rem;
      bottom: -1rem;
      width: 2px;
      background: var(--border-subtle);
    }

    .timeline-item:last-child .timeline-line { display: none; }

    .timeline-body { flex: 1; }

    .timeline-age {
      font-size: 0.75rem;
      font-weight: 700;
      color: var(--text-ember);
      letter-spacing: 0.04em;
      margin-bottom: 0.25rem;
    }

    .timeline-text {
      font-size: 0.875rem;
      color: var(--text-secondary);
      line-height: 1.6;
    }

    @media (min-width: 640px) {
      .shell {
        height: 844px;
        max-height: 92vh;
        border-radius: 2.5rem;
        border: 1px solid var(--border-subtle);
      }
    }
  </style>
</head>
<body>
  <div class="shell">
    <div class="bg-orb bg-orb--ember"></div>
    <div class="bg-orb bg-orb--amber"></div>

    <div class="module-header">
      <div class="module-header__row">
        <button class="header-back" onclick="ModuleEngine.goBackToPathway()">‚Üê</button>
        <p class="header-title" id="moduleTitle">Your Patterns and Where They Came From</p>
        <span class="header-count" id="stepCounter"></span>
      </div>
      <div class="progress-dots" id="progressDots"></div>
    </div>

    <div class="module-scroll" id="moduleScroll">
      <div class="step-wrap" id="stepContent"></div>
    </div>

    <div class="cta-area">
      <button class="back-btn-sm" id="backBtn" onclick="ModuleEngine.back()" disabled>‚Üê</button>
      <button class="btn btn--primary" id="nextBtn" onclick="ModuleEngine.next()">Continue</button>
    </div>
  </div>

  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <div class="loading-text" id="loadingText">Loading...</div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="/js/supabase-client.js"></script>
  <script src="/js/utils.js"></script>
  <script src="/js/module-engine.js"></script>
  <script>

  const B = ModuleEngine.Blocks;

  // ‚îÄ‚îÄ Pattern selector ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  const selectedPatterns = new Set();

  function togglePattern(el, name) {
    el.classList.toggle('pattern-option--selected');
    if (selectedPatterns.has(name)) {
      selectedPatterns.delete(name);
    } else {
      selectedPatterns.add(name);
    }
    const hidden = document.getElementById('patternsHidden');
    if (hidden) hidden.value = Array.from(selectedPatterns).join(', ');
    const nextBtn = document.getElementById('nextBtn');
    if (nextBtn) nextBtn.disabled = selectedPatterns.size === 0;
  }

  // ================================================================
  // PATTERN DEFINITIONS
  // ================================================================

  const PATTERNS = [
    {
      emoji: 'üî•',
      name: 'Overreacting then regretting',
      desc: 'A trigger fires, you respond more intensely than the situation warranted, then spend time managing the fallout and shame'
    },
    {
      emoji: 'üåë',
      name: 'Shutting down and withdrawing',
      desc: 'When things get hard, you go quiet ‚Äî emotionally unavailable, hard to reach, waiting for it to pass'
    },
    {
      emoji: 'üé≠',
      name: 'People-pleasing at your own expense',
      desc: 'Saying yes when you mean no. Managing everyone else\'s feelings before your own. Resentment that builds quietly.'
    },
    {
      emoji: 'üîÑ',
      name: 'Seeking reassurance that never satisfies',
      desc: 'Needing to be told things are okay. Feeling okay briefly, then needing to check again. Never quite landing.'
    },
    {
      emoji: 'üß±',
      name: 'Keeping people at arm\'s length',
      desc: 'Staying just close enough to not be alone but not close enough to be known. Intimacy feels unsafe.'
    },
    {
      emoji: '‚ö°',
      name: 'Catastrophising when uncertain',
      desc: 'Uncertainty becomes threat. You fill the unknown with worst-case scenarios. Planning for disaster as a way of feeling control.'
    },
    {
      emoji: 'ü™®',
      name: 'Holding impossibly high standards',
      desc: 'For yourself, sometimes for others. Anything less than perfect is failure. Rest feels like falling behind.'
    },
    {
      emoji: 'üèÉ',
      name: 'Staying so busy you never have to feel',
      desc: 'Filling every available moment. Productivity as avoidance. Stillness is where the difficult things live.'
    },
    {
      emoji: 'üí•',
      name: 'Making things about me when they\'re not',
      desc: 'Personalising neutral events. Reading intention into accidents. Assuming silence means disapproval.'
    },
    {
      emoji: 'üåä',
      name: 'Getting flooded and losing myself',
      desc: 'Overwhelm arrives and everything collapses ‚Äî capacity to think, to communicate, to stay present. A total state change.'
    }
  ];

  // ================================================================
  // MODULE STEPS
  // ================================================================

  const EM5_STEPS = [

    // ‚îÄ‚îÄ STEP 1: Intro ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    {
      type: 'intro',
      render: () => `
        ${B.heading('You\'ve been running the same patterns for years. This module is about finally seeing them.')}
        ${B.para('Not to judge them. Not because they\'re character flaws. But because a pattern you can see is a pattern you can work with. A pattern you can\'t see is one that runs you.')}
        ${B.para('Every emotional pattern you have made sense at some point. It was a solution to a real problem ‚Äî usually one you were facing when you were too young to have better options.')}
        ${B.callout('You didn\'t develop your patterns because something is wrong with you. You developed them because you were a child navigating a world that was larger and more powerful than you were, using the only tools you had available.')}
        ${B.para('Understanding that doesn\'t excuse the patterns. But it changes the relationship from shame to curiosity ‚Äî and curiosity is how change actually begins.')}
      `
    },

    // ‚îÄ‚îÄ STEP 2: Concept ‚Äî What a pattern is ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    {
      type: 'concept',
      render: () => `
        ${B.heading('A pattern is a learned solution that outlived the problem it solved.')}
        ${B.para('Here\'s the anatomy of how a pattern forms:')}

        <div style="margin-bottom:1.25rem">
          <div class="timeline-item">
            <div style="position:relative">
              <div class="timeline-dot"></div>
              <div class="timeline-line"></div>
            </div>
            <div class="timeline-body">
              <p class="timeline-age">Early experience</p>
              <p class="timeline-text">Something happens repeatedly in your environment ‚Äî a parent who was emotionally unpredictable, a household where anger wasn't safe, a school where vulnerability was punished, love that felt conditional on performance.</p>
            </div>
          </div>

          <div class="timeline-item">
            <div style="position:relative">
              <div class="timeline-dot"></div>
              <div class="timeline-line"></div>
            </div>
            <div class="timeline-body">
              <p class="timeline-age">Adaptation</p>
              <p class="timeline-text">You develop a response that manages the situation. Shut down to avoid conflict. Perform to earn love. Please to stay safe. Stay vigilant to prevent the bad thing.</p>
            </div>
          </div>

          <div class="timeline-item">
            <div style="position:relative">
              <div class="timeline-dot"></div>
              <div class="timeline-line"></div>
            </div>
            <div class="timeline-body">
              <p class="timeline-age">Consolidation</p>
              <p class="timeline-text">The adaptation works well enough that it gets repeated. It becomes automatic ‚Äî a neural pathway that fires before you're consciously aware it's happening.</p>
            </div>
          </div>

          <div class="timeline-item">
            <div style="position:relative">
              <div class="timeline-dot"></div>
              <div class="timeline-line"></div>
            </div>
            <div class="timeline-body">
              <p class="timeline-age">Now</p>
              <p class="timeline-text">The original situation is long gone. But the pattern fires whenever something triggers the same emotional signature ‚Äî even if the current situation is completely different.</p>
            </div>
          </div>
        </div>

        ${B.insight('The key insight', 'The trigger in the present moment is never quite the whole story. Underneath it is almost always an older, more primal situation the current moment is reminding your nervous system of.')}
      `
    },

    // ‚îÄ‚îÄ STEP 3: Concept ‚Äî Triggers and roots ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    {
      type: 'concept',
      render: () => `
        ${B.heading('Triggers are almost never about what they appear to be about.')}
        ${B.para('When a reaction feels disproportionate ‚Äî bigger than the situation seems to warrant ‚Äî that\'s usually a signal that an old wound is involved.')}

        <div style="
          background:var(--bg-card-light);
          border:1px solid var(--border-soft);
          border-radius:1rem;
          overflow:hidden;
          margin-bottom:1.25rem;
        ">
          <div style="padding:1rem 1.125rem;border-bottom:1px solid var(--border-subtle)">
            <p style="font-size:0.75rem;font-weight:700;text-transform:uppercase;letter-spacing:0.06em;color:var(--text-muted);margin-bottom:0.375rem">Presenting trigger</p>
            <p style="font-size:0.9375rem;color:var(--text-primary)">Partner asks why you're late</p>
          </div>
          <div style="padding:1rem 1.125rem;border-bottom:1px solid var(--border-subtle)">
            <p style="font-size:0.75rem;font-weight:700;text-transform:uppercase;letter-spacing:0.06em;color:var(--text-gold);margin-bottom:0.375rem">Emotional signature activated</p>
            <p style="font-size:0.875rem;color:var(--text-secondary)">Being questioned. Feeling accused. Needing to defend.</p>
          </div>
          <div style="padding:1rem 1.125rem">
            <p style="font-size:0.75rem;font-weight:700;text-transform:uppercase;letter-spacing:0.06em;color:var(--text-ember);margin-bottom:0.375rem">What it's actually connected to</p>
            <p style="font-size:0.875rem;color:var(--text-secondary)">A parent who interrogated you. An environment where you were regularly blamed. Years of having to explain yourself or face consequences.</p>
          </div>
        </div>

        ${B.para('The partner asking about the time is not the threat. The nervous system has matched the emotional signature to an older situation and is responding to that.')}
        ${B.para('This is why logic doesn\'t work on triggered states. You can\'t think your way out of a nervous system response that\'s responding to a situation that happened twenty years ago.')}
        ${B.callout('The pattern isn\'t irrational. It\'s hyper-rational ‚Äî given the original context. The work is helping your nervous system learn that the original context is gone.')}
      `
    },

    // ‚îÄ‚îÄ STEP 4: Worksheet ‚Äî Identify your patterns ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    {
      type: 'worksheet',
      render: () => `
        ${B.heading('Which patterns do you recognise in yourself?')}
        ${B.para('Select all that show up in your life ‚Äî even ones that feel uncomfortable to admit. You can\'t work with a pattern you won\'t look at.')}

        <div style="margin-bottom:0.5rem">
          ${PATTERNS.map(p => `
            <button
              class="pattern-option"
              onclick="togglePattern(this, '${p.name.replace(/'/g, "\\'")}')"
            >
              <span class="pattern-option__emoji">${p.emoji}</span>
              <div class="pattern-option__body">
                <p class="pattern-option__name">${p.name}</p>
                <p class="pattern-option__desc">${p.desc}</p>
              </div>
              <span class="pattern-option__check">‚úì</span>
            </button>
          `).join('')}
        </div>
        <input type="hidden" id="patternsHidden" data-key="patterns" value="">
        ${B.para('Select at least one to continue.', 'font-size:0.8125rem;color:var(--text-muted);text-align:center')}
      `,
      afterRender: () => {
        const nextBtn = document.getElementById('nextBtn');
        if (nextBtn) nextBtn.disabled = true;
      }
    },

    // ‚îÄ‚îÄ STEP 5: Worksheet ‚Äî Map your primary pattern ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    {
      type: 'worksheet',
      render: () => `
        ${B.heading('Map your primary pattern.')}
        ${B.para('Pick the one that creates the most difficulty in your life right now. The one that, when it fires, you most wish you could change.')}
        ${B.para('We\'re going to trace it all the way back.')}

        ${B.divider('The pattern')}
        ${B.keyedTextarea('pattern-name', 'The pattern I\'m mapping is...', 'Name it in your own words ‚Äî not the label, but what it actually looks like when it happens', '65px')}

        ${B.divider('When it fires')}
        ${B.keyedTextarea('pattern-trigger', 'It shows up when...', 'What specific situations, words, tones, silences, or events reliably trigger it?', '75px')}

        ${B.divider('What happens')}
        ${B.keyedTextarea('pattern-response', 'When it fires, I...', 'Describe the automatic response ‚Äî what you feel, what you do, what you say or don\'t say', '75px')}

        ${B.divider('The cost')}
        ${B.keyedTextarea('pattern-cost', 'The cost of this pattern has been...', 'In relationships, at work, in how you feel about yourself ‚Äî what has it cost you?', '75px')}
      `
    },

    // ‚îÄ‚îÄ STEP 6: Worksheet ‚Äî Trace the origin ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    {
      type: 'worksheet',
      render: () => `
        ${B.heading('Where did it come from?')}
        ${B.para('This is the harder question ‚Äî and the more important one. Think back. Not to assign blame, but to understand. Patterns come from somewhere. Finding that somewhere changes the relationship to the pattern.')}

        ${B.divider('The origin')}
        ${B.keyedTextarea('origin-situation', 'This pattern might have started when...', 'What early experience ‚Äî repeated or one-off ‚Äî might have taught you this response? What was happening around you when you were young?', '90px')}

        ${B.keyedTextarea('origin-logic', 'At the time, this response made sense because...', 'What did it protect you from? What problem did it solve? How was it useful then?', '80px')}

        ${B.divider('Now')}
        ${B.keyedTextarea('origin-now', 'Today, when this pattern fires, the situation that originally caused it...', 'Is that original situation still present? Or is your nervous system responding to a ghost?', '70px')}

        ${B.callout('You are not the pattern. You are the person who developed the pattern in response to something real. Those are different things ‚Äî and only one of them can change.')}
      `
    },

    // ‚îÄ‚îÄ STEP 7: Worksheet ‚Äî Interrupting it ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    {
      type: 'worksheet',
      render: () => `
        ${B.heading('Finding the gap.')}
        ${B.para('You cannot stop a pattern from firing. The neural pathway is established. What you can do is widen the gap between the pattern firing and acting on it ‚Äî from milliseconds to seconds to minutes.')}
        ${B.para('That gap is where every intervention lives.')}

        ${B.steps([
          '<strong>Early warning signs.</strong> The pattern announces itself before it fully arrives ‚Äî subtle body signals, a particular thought, a familiar pull.',
          '<strong>Name it immediately.</strong> "My [pattern] is firing." Not a judgment ‚Äî a neutral observation.',
          '<strong>Do not act for 5 seconds.</strong> Just don\'t. Nothing. Let the initial wave pass.',
          '<strong>Body first.</strong> One physiological sigh. One body check. Come back into your body before you act.',
          '<strong>Ask:</strong> "What does this situation actually require? Not what does the pattern want me to do ‚Äî what does this moment actually need from me?"'
        ])}

        ${B.divider('Your early warning signs')}
        ${B.keyedTextarea('warnings', 'I can tell my pattern is about to fire when I notice...', 'The body signals, thoughts, or feelings that arrive just before the pattern takes over', '80px')}

        ${B.keyedTextarea('interrupt', 'The most realistic way I could interrupt it in the moment is...', 'Given how this pattern actually operates in your life ‚Äî what\'s the smallest, most achievable intervention?', '80px')}
      `
    },

    // ‚îÄ‚îÄ STEP 8: Skill ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    {
      type: 'skill',
      render: () => `
        ${B.heading('Your fifth tool.')}
        ${B.para('This is the most sophisticated tool in the set so far. It requires everything you\'ve built in the previous four modules.')}
        ${B.skill(
          'Catch, Name, Pause, Choose',
          'Insert a gap between trigger and automatic response.',
          [
            '<strong>Catch it.</strong> Notice the activation ‚Äî the heat, the pull, the urge, the familiar feeling. "I\'m doing the thing." The earlier you catch it, the wider the gap you have.',
            '<strong>Name the pattern.</strong> Not a judgment ‚Äî a label. "This is my shutdown pattern." "This is me going into please-mode." "This is the thing that happened with Dad." Naming it separates you from it.',
            '<strong>Five-second pause.</strong> Don\'t suppress the feeling ‚Äî just don\'t act on it for five seconds. Breathe. Body check. Let the first wave pass.',
            '<strong>Choose.</strong> Ask: "What would I do right now if I wasn\'t running this pattern?" Then do that. Not the pattern\'s preferred action ‚Äî the action of the person you\'re trying to be.'
          ]
        )}
        ${B.compare(
          'Before: Trigger ‚Üí pattern fires ‚Üí automatic behaviour ‚Üí consequences ‚Üí shame ‚Üí resolve to do better ‚Üí same trigger ‚Üí same pattern.',
          'After: Trigger ‚Üí pattern fires ‚Üí catch it ‚Üí name it ‚Üí pause ‚Üí choose ‚Üí different behaviour ‚Üí different outcome ‚Üí pattern slowly loses its grip.'
        )}
        ${B.insight('The honest part', 'This doesn\'t work every time. Especially at first. The pattern will win more often than not while you\'re learning. That\'s not failure ‚Äî that\'s how neural reprogramming actually works. Every time you catch it, even if you still act on it, the gap gets slightly wider.')}
      `
    },

    // ‚îÄ‚îÄ STEP 9: Commitment ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    {
      type: 'commitment',
      render: () => `
        ${B.heading('Your commitment.')}
        ${B.para('You\'ve mapped your primary pattern, traced it back, and identified your early warning signs. Now comes the only part that actually changes anything: practice in the real situation.')}
        ${B.para('This week, when you notice your pattern firing, your only job is to catch it and name it. You don\'t have to stop it yet. Just catch it and name it. That\'s the first rep.')}
        ${B.commitment(
          'Write the specific pattern, the situation where it\'s most likely to fire this week, and what you\'ll do when you catch it.',
          'This week when [trigger situation] and I notice [early warning sign], I will say to myself: "My [pattern name] is firing." Then I will pause for five seconds before I do anything. Even if the pattern still wins, I\'ll have caught it. That counts.'
        )}
      `
    },

    // ‚îÄ‚îÄ STEP 10: Complete ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    {
      type: 'complete',
      render: () => B.complete(
        'Your Patterns and Where They Came From',
        'emotional',
        'em-6',
        '‚è∏',
        'Catch, Name, Pause, Choose',
        'Insert a gap between trigger and automatic response'
      )
    }

  ];

  document.addEventListener('DOMContentLoaded', () => {
    ModuleEngine.init('em-5', EM5_STEPS);
  });

  </script>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js').catch(() => {});
    }
  </script>
</body>
</html>
