<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0d0906">
  <title>InnerShadow ‚Äì Talking to Yourself Like a Human Being</title>
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="/css/main.css">
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    html, body {
      position: fixed;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    body {
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-dark);
    }

    .shell {
      width: 100%;
      max-width: 28rem;
      height: 100vh;
      height: -webkit-fill-available;
      background: var(--bg-card);
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
      border-left: 1px solid var(--border-subtle);
      border-right: 1px solid var(--border-subtle);
    }

    .module-header {
      padding: max(1rem, env(safe-area-inset-top)) 1.25rem 0.875rem;
      background: rgba(10,15,30,0.95);
      border-bottom: 1px solid var(--border-subtle);
      flex-shrink: 0;
      z-index: 10;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .module-header__row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .header-back {
      width: 2.25rem;
      height: 2.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-card-light);
      border: 1px solid var(--border-soft);
      border-radius: 0.625rem;
      color: var(--text-primary);
      font-size: 1rem;
      cursor: pointer;
      transition: var(--transition-fast);
      flex-shrink: 0;
    }

    .header-back:active { transform: scale(0.92); }

    .header-title {
      flex: 1;
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-primary);
      line-height: 1.3;
      text-align: center;
    }

    .header-count {
      font-size: 0.8125rem;
      color: var(--text-muted);
      font-weight: 500;
      min-width: 2.25rem;
      text-align: right;
    }

    .progress-dots {
      display: flex;
      gap: 0.3rem;
    }

    .progress-dot {
      flex: 1;
      height: 3px;
      background: rgba(148,163,184,0.15);
      border-radius: 999px;
      transition: background 0.4s ease;
    }

    .progress-dot--active {
      background: var(--gradient-main);
    }

    .module-scroll {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }

    .module-scroll::-webkit-scrollbar { display: none; }

    .step-wrap {
      padding: 1.375rem 1.25rem 2rem;
    }

    .cta-area {
      padding: 1rem 1.25rem max(1rem, env(safe-area-inset-bottom));
      background: rgba(10,15,30,0.95);
      border-top: 1px solid var(--border-subtle);
      display: flex;
      gap: 0.75rem;
      align-items: center;
      flex-shrink: 0;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .back-btn-sm {
      width: 3rem;
      height: 3rem;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-card-light);
      border: 1px solid var(--border-soft);
      border-radius: 0.875rem;
      color: var(--text-secondary);
      font-size: 1.125rem;
      cursor: pointer;
      transition: var(--transition-fast);
      flex-shrink: 0;
    }

    .back-btn-sm:active { transform: scale(0.92); }
    .back-btn-sm:disabled { opacity: 0.3; cursor: default; }

    /* Inner critic rating */
    .critic-scale {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      justify-content: space-between;
    }

    .critic-btn {
      flex: 1;
      padding: 0.75rem 0.25rem;
      background: var(--bg-card-light);
      border: 1.5px solid var(--border-soft);
      border-radius: 0.875rem;
      font-size: 0.875rem;
      font-weight: 700;
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.18s ease;
      font-family: var(--font-body);
      text-align: center;
    }

    .critic-btn:active { transform: scale(0.92); }

    .critic-btn--selected {
      border-color: var(--ember-border-strong);
      background: var(--ember-bg-strong);
      color: var(--text-ember);
    }

    /* Three pillars */
    .pillar-card {
      background: var(--gradient-card);
      border: 1px solid var(--border-soft);
      border-radius: 1.125rem;
      padding: 1.125rem;
      margin-bottom: 0.75rem;
    }

    .pillar-card__num {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 1.75rem;
      height: 1.75rem;
      background: var(--gradient-main);
      border-radius: 0.5rem;
      font-size: 0.8125rem;
      font-weight: 700;
      color: white;
      margin-bottom: 0.625rem;
    }

    .pillar-card__name {
      font-size: 1rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.375rem;
    }

    .pillar-card__desc {
      font-size: 0.875rem;
      color: var(--text-secondary);
      line-height: 1.6;
    }

    /* Friend test */
    .friend-card {
      background: var(--ember-bg);
      border: 1px solid var(--ember-border);
      border-radius: 1.25rem;
      padding: 1.25rem;
      margin-bottom: 1rem;
    }

    .speech-bubble {
      background: rgba(255,255,255,0.06);
      border: 1px solid var(--border-soft);
      border-radius: 0.875rem 0.875rem 0.875rem 0.125rem;
      padding: 0.875rem 1rem;
      margin-bottom: 0.875rem;
      font-size: 0.9375rem;
      color: var(--text-secondary);
      line-height: 1.6;
      font-style: italic;
    }

    @media (min-width: 640px) {
      .shell {
        height: 844px;
        max-height: 92vh;
        border-radius: 2.5rem;
        border: 1px solid var(--border-subtle);
      }
    }
  </style>
</head>
<body>
  <div class="shell">
    <div class="bg-orb bg-orb--ember"></div>
    <div class="bg-orb bg-orb--amber"></div>

    <div class="module-header">
      <div class="module-header__row">
        <button class="header-back" onclick="ModuleEngine.goBackToPathway()">‚Üê</button>
        <p class="header-title" id="moduleTitle">Talking to Yourself Like a Human Being</p>
        <span class="header-count" id="stepCounter"></span>
      </div>
      <div class="progress-dots" id="progressDots"></div>
    </div>

    <div class="module-scroll" id="moduleScroll">
      <div class="step-wrap" id="stepContent"></div>
    </div>

    <div class="cta-area">
      <button class="back-btn-sm" id="backBtn" onclick="ModuleEngine.back()" disabled>‚Üê</button>
      <button class="btn btn--primary" id="nextBtn" onclick="ModuleEngine.next()">Continue</button>
    </div>
  </div>

  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <div class="loading-text" id="loadingText">Loading...</div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="/js/supabase-client.js"></script>
  <script src="/js/utils.js"></script>
  <script src="/js/module-engine.js"></script>
  <script>

  const B = ModuleEngine.Blocks;

  function selectCriticRating(el, value) {
    document.querySelectorAll('.critic-btn').forEach(b => b.classList.remove('critic-btn--selected'));
    el.classList.add('critic-btn--selected');
    const hidden = document.getElementById('criticRatingHidden');
    if (hidden) hidden.value = value;
    const nextBtn = document.getElementById('nextBtn');
    if (nextBtn) nextBtn.disabled = false;
  }

  // ================================================================
  // MODULE EM-4: TALKING TO YOURSELF LIKE A HUMAN BEING
  // ================================================================

  const EM4_STEPS = [

    // ‚îÄ‚îÄ STEP 1: Intro ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    {
      type: 'intro',
      render: () => `
        ${B.heading('You have a voice in your head that no decent person would tolerate from anyone else.')}
        ${B.para('It tells you you\'re stupid, weak, embarrassing, not enough. It replays your failures in high definition. It compares you unfavourably to everyone around you. It predicts that you\'ll fail again.')}
        ${B.para('If a friend spoke to you the way your inner critic speaks to you, you\'d have ended the friendship years ago.')}
        ${B.callout('The strange thing is that most people believe the inner critic is helping them. That without it, they\'d become lazy, arrogant, irresponsible. This module is going to show you exactly why that\'s wrong.')}
        ${B.para('And then it\'s going to give you something that actually works ‚Äî which produces better outcomes, more resilience, and significantly less suffering than the critic ever has.')}
      `
    },

    // ‚îÄ‚îÄ STEP 2: Concept ‚Äî What the inner critic is ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    {
      type: 'concept',
      render: () => `
        ${B.heading('Where the inner critic came from.')}
        ${B.para('The inner critic is not your true voice. It\'s an internalised voice ‚Äî assembled from things that were said to you, implied about you, or modelled around you when you were young enough that you had no defences against it.')}
        ${B.para('Parents, teachers, siblings, peers. The standards of the household you grew up in. The messages culture sent about what you were supposed to be.')}
        ${B.insight('The origin', 'The inner critic usually began as an attempt to keep you safe ‚Äî to pre-empt criticism by criticising yourself first, to motivate you through shame, to prevent rejection by performing adequacy. It was adaptive once. It\'s now misfiring.')}
        ${B.para('Understanding where it came from doesn\'t make it go away. But it does change the relationship. You stop hearing it as truth and start hearing it as a recorded message from the past ‚Äî often from someone who didn\'t fully know how to help you.')}
        ${B.compare(
          'The critic as truth: "I failed again. This proves I\'m not capable. I should have known better. What\'s wrong with me."',
          'The critic as recorded message: "There\'s that old voice again. It\'s telling me I failed. That used to mean danger. Right now it just means I\'m human."'
        )}
      `
    },

    // ‚îÄ‚îÄ STEP 3: Concept ‚Äî Why criticism doesn't work ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    {
      type: 'concept',
      render: () => `
        ${B.heading('Self-criticism is not a performance strategy. It\'s a threat response.')}
        ${B.para('Here\'s what the brain science actually says about self-criticism:')}
        ${B.steps([
          '<strong>Self-criticism activates the threat system.</strong> The same amygdala response that fires when you\'re in physical danger fires when you berate yourself. Cortisol rises. Prefrontal cortex ‚Äî where your best thinking lives ‚Äî goes partially offline.',
          '<strong>Threat mode narrows your thinking.</strong> When the threat system is active, your cognitive range shrinks. You see fewer options, think less creatively, access less of your actual capability.',
          '<strong>Shame is not a motivator ‚Äî it\'s a paralytic.</strong> Research consistently shows that shame produces avoidance and withdrawal, not productive action. Guilt (about behaviour) can motivate change. Shame (about identity) does not.',
          '<strong>The critic doesn\'t raise standards ‚Äî it lowers performance.</strong> Athletes, executives, and students all perform worse under self-critical pressure than under self-compassionate encouragement.'
        ])}
        ${B.callout('The inner critic feels like it\'s protecting you. What it\'s actually doing is keeping you in a low-grade threat state that makes everything harder.')}
      `
    },

    // ‚îÄ‚îÄ STEP 4: Concept ‚Äî The three components ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    {
      type: 'concept',
      render: () => `
        ${B.heading('What self-compassion actually is.')}
        ${B.para('Self-compassion is not self-pity. It\'s not making excuses. It\'s not lowering your standards or deciding nothing matters. Kristin Neff\'s research identifies three specific components:')}

        <div class="pillar-card">
          <div class="pillar-card__num">1</div>
          <p class="pillar-card__name">Mindfulness</p>
          <p class="pillar-card__desc">Acknowledging that something hurts ‚Äî without suppressing it and without amplifying it. Holding the pain with clear eyes rather than pretending it isn\'t there or spiralling into it.</p>
        </div>

        <div class="pillar-card">
          <div class="pillar-card__num">2</div>
          <p class="pillar-card__name">Common humanity</p>
          <p class="pillar-card__desc">Recognising that suffering, failure, and feeling inadequate are part of the shared human experience ‚Äî not a sign that something is uniquely wrong with you. You are not alone in this. Everyone who has ever lived has felt what you\'re feeling.</p>
        </div>

        <div class="pillar-card">
          <div class="pillar-card__num">3</div>
          <p class="pillar-card__name">Self-kindness</p>
          <p class="pillar-card__desc">Responding to your own pain with the same basic warmth you\'d offer a friend who was struggling. Not agreement, not avoidance ‚Äî genuine care. The care that makes hard things survivable.</p>
        </div>

        ${B.insight('What the research shows', 'Self-compassion (not self-esteem) is the strongest single predictor of psychological wellbeing, resilience after failure, and intrinsic motivation. It also produces better accountability ‚Äî people who are self-compassionate are more likely to acknowledge mistakes and less likely to repeat them.')}
      `
    },

    // ‚îÄ‚îÄ STEP 5: Worksheet ‚Äî Audit the critic ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    {
      type: 'worksheet',
      render: () => `
        ${B.heading('What does your inner critic actually say?')}
        ${B.para('Most people have never looked directly at the voice. They\'ve just let it run. Let\'s look at it now.')}

        ${B.divider('The critic\'s greatest hits')}
        ${B.keyedTextarea('critic-lines', 'Write 3‚Äì5 things your inner critic says most often...', '"You\'re too sensitive." "You always mess this up." "Why can\'t you just get it together." Write them as the critic says them.', '110px')}

        ${B.divider('How loud is it?')}
        <p style="font-size:0.875rem;color:var(--text-secondary);margin-bottom:0.75rem">
          On a typical day, how loud is the inner critic?
        </p>
        <div class="critic-scale">
          ${['Quiet','Moderate','Loud','Constant'].map((label, i) => `
            <button class="critic-btn" onclick="selectCriticRating(this, '${label.toLowerCase()}')">
              ${label}
            </button>
          `).join('')}
        </div>
        <input type="hidden" id="criticRatingHidden" data-key="volume" value="">

        ${B.keyedTextarea('critic-trigger', 'It gets loudest when...', 'What situations, mistakes, or comparisons trigger it most reliably?', '75px')}
      `,
      afterRender: () => {
        const nextBtn = document.getElementById('nextBtn');
        if (nextBtn) nextBtn.disabled = false;
      }
    },

    // ‚îÄ‚îÄ STEP 6: Worksheet ‚Äî The friend test ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    {
      type: 'worksheet',
      render: () => `
        ${B.heading('The friend test.')}
        ${B.para('This is the exercise that shifts things for most people. It\'s simple and it\'s uncomfortable.')}

        <div class="friend-card">
          <p style="font-size:0.8125rem;font-weight:700;color:var(--text-ember);margin-bottom:0.75rem;letter-spacing:0.05em;text-transform:uppercase">
            The scenario
          </p>
          <p style="font-size:0.9375rem;color:var(--text-secondary);line-height:1.7;margin-bottom:0">
            Imagine a close friend ‚Äî someone you genuinely care about ‚Äî comes to you after failing at something important to them. They\'re ashamed. They\'re beating themselves up. They feel stupid and inadequate.
          </p>
        </div>

        ${B.keyedTextarea('friend-response', 'What would you actually say to them?', 'Write what you\'d genuinely say ‚Äî not what sounds nice, but what you\'d actually want them to hear.', '90px')}

        ${B.divider('Now turn it around')}
        ${B.keyedTextarea('self-response', 'What do you actually say to yourself in that same situation?', 'Write what the inner critic says ‚Äî as specifically as you can.', '90px')}

        ${B.keyedTextarea('gap', 'The gap between those two responses is...', 'What do you notice about the difference? Why would you offer a friend something you won\'t offer yourself?', '80px')}

        ${B.callout('Most people find this exercise confronting. The gap is usually much larger than they expected. That gap is not motivation ‚Äî it\'s unnecessary suffering.')}
      `
    },

    // ‚îÄ‚îÄ STEP 7: Worksheet ‚Äî Practice the pause ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    {
      type: 'worksheet',
      render: () => `
        ${B.heading('Now write it for yourself.')}
        ${B.para('Take the situation where your inner critic is loudest. Write what you would say to yourself if you were talking to yourself the way you talked to your friend.')}
        ${B.para('This will feel strange. It may feel like lying, or like letting yourself off the hook. Do it anyway ‚Äî the discomfort is evidence of how unfamiliar it is, not evidence that it\'s wrong.')}

        ${B.divider('The situation')}
        ${B.keyedTextarea('situation', 'The situation where the critic is loudest...', 'A recent example ‚Äî something you\'ve been beating yourself up over', '70px')}

        ${B.divider('What the critic says')}
        ${B.keyedTextarea('critic-voice', 'The critic says...', 'Write the actual words, as harsh as they are', '65px')}

        ${B.divider('What a friend would say')}
        ${B.keyedTextarea('friend-voice', 'If I were a friend to myself, I would say...', 'Write it warmly, honestly ‚Äî acknowledging the difficulty without amplifying the shame', '90px')}

        ${B.insight('What you\'re building', 'This is not natural at first. It\'s a new neural pathway. Every time you do this, you\'re making it slightly more accessible next time. The goal isn\'t to feel immediately better ‚Äî it\'s to begin building the habit of basic self-decency.')}
      `
    },

    // ‚îÄ‚îÄ STEP 8: Skill ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    {
      type: 'skill',
      render: () => `
        ${B.heading('Your fourth tool.')}
        ${B.para('Kristin Neff\'s self-compassion pause ‚Äî adapted for daily use. Three moves. Less than two minutes.')}
        ${B.skill(
          'Self-Compassion Pause',
          'Respond to your own pain the way you\'d respond to a friend\'s.',
          [
            '<strong>Acknowledge:</strong> "This is a moment of pain." Say it plainly ‚Äî out loud or internally. Don\'t minimise ("it\'s fine") and don\'t catastrophise ("this is the worst"). Just name it accurately.',
            '<strong>Connect:</strong> "Suffering is part of being human." You are not uniquely broken. You are not the only one who has ever felt this. This is the universal experience of being alive.',
            '<strong>Hand on chest.</strong> Place one hand over your heart. Feel the warmth. This small gesture activates the caregiving system in a measurable way.',
            '<strong>Ask: what do I need right now?</strong> Not what should I do ‚Äî what do I actually need? Sometimes it\'s reassurance. Sometimes it\'s to be left alone. Sometimes it\'s just to be acknowledged.'
          ]
        )}
        ${B.compare(
          'Inner critic response to failure: "I knew this would happen. I\'m not capable. I should have done better. What\'s wrong with me."',
          'Self-compassion pause response: "This hurts. It\'s supposed to hurt ‚Äî I cared about this. Everyone fails sometimes. What do I actually need right now?"'
        )}
        ${B.para('One of these activates the threat system and impairs your recovery. The other activates the soothing system and supports it. The research on which produces better long-term outcomes is not close.')}
      `
    },

    // ‚îÄ‚îÄ STEP 9: Commitment ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    {
      type: 'commitment',
      render: () => `
        ${B.heading('Your commitment.')}
        ${B.para('The inner critic has had decades of practice. The self-compassionate voice is new and will feel false at first. That\'s normal. It gets more natural ‚Äî but only if you use it.')}
        ${B.para('This week, when the inner critic fires ‚Äî and it will ‚Äî you\'re going to run the self-compassion pause before you let the critic finish its speech.')}
        ${B.commitment(
          'Think of the specific situation where the critic is loudest. Commit to using the self-compassion pause there this week ‚Äî even once.',
          'This week when [the critic fires, especially when...], instead of letting it run, I will pause and say: "This is a moment of pain. This is part of being human." And I\'ll ask myself what I actually need. I expect this to feel...'
        )}
      `
    },

    // ‚îÄ‚îÄ STEP 10: Complete ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    {
      type: 'complete',
      render: () => B.complete(
        'Talking to Yourself Like a Human Being',
        'emotional',
        'em-5',
        'ü§≤',
        'Self-Compassion Pause',
        'Respond to your own pain the way you\'d respond to a friend\'s'
      )
    }

  ];

  document.addEventListener('DOMContentLoaded', () => {
    ModuleEngine.init('em-4', EM4_STEPS);
  });

  </script>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js').catch(() => {});
    }
  </script>
</body>
</html>
